# VG Security Override: Modsecurity/CRS Configuration Only
#
# This file contains ONLY security-related configurations (modsecurity, CRS).
# For development overrides (live reload, etc.), see docker-compose.dev-overrides.yml
#
# Usage:
#   Production:  docker compose up
#   Development: docker compose -f docker-compose.yml -f docker-compose.override.yml -f docker-compose.dev.yml up

services:
  nginx:
    build:
      args:
        NGINX_BASE_IMAGE: ${NGINX_BASE_IMAGE:-drguptavivek/central-nginx-vg-base:6.0.1}
    volumes:
      # VG modsecurity nginx configs
      - ./files/vg-nginx/vg-nginx-modules.conf:/etc/nginx/modules-enabled/50-vg-nginx-modules.conf:ro
      - ./files/vg-nginx/vg-modsecurity-odk.conf:/etc/modsecurity/modsecurity-odk.conf:ro
      - ./files/vg-nginx/vg-headers-more.conf:/usr/share/odk/nginx/vg-headers-more.conf:ro
      # Modsecurity CRS configs
      - ./crs/crs-setup.conf.example:/etc/modsecurity/crs/crs-setup.conf:ro
      - ./crs/rules:/etc/modsecurity/crs/rules:ro
      - ./crs_custom:/etc/modsecurity/custom:ro
      # Security logging
      - ./logs/nginx:/var/log/nginx
      - ./logs/modsecurity:/var/log/modsecurity

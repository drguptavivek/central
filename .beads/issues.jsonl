{"id":"central-044","title":"Verify docs/vg/vg-server/vg_implementation.md","notes":"GitHub:\n- gh-12 https://github.com/drguptavivek/central/issues/12\n\nSummary:\n- Verified docs/vg/vg-server/vg_implementation.md is present and consistent with current implementation notes.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg-server/vg_implementation.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:15:38.808865+05:30","updated_at":"2025-12-29T20:09:39.718547+05:30","closed_at":"2025-12-27T13:23:50.14623+05:30","close_reason":"Verified: Implementation files exist.","external_ref":"gh-12"}
{"id":"central-0ap","title":"Self revoke: vg_app_user_sessions row not expired, list may show active","description":"Scenario: app user calls POST /projects/:projectId/app-users/:id/revoke for current session.\nCurrent behavior: revokeSessions(currentOnly=true) deletes the session from core `sessions` table but does not update `vg_app_user_sessions.expires_at` or mark it revoked.\nImpact: session history still shows a future expiresAt for the revoked session; admins may think it is still active.\nDecision: set expires_at to now for current session (by id/token) or annotate revoked state; alternatively document the mismatch.\nRefs: server/lib/resources/vg-app-user-auth.js self revoke handler; server/lib/domain/vg-app-user-auth.js revokeSessions(); server/lib/model/query/vg-app-user-auth.js recordSession()/getSessionsByActorId().\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:01:04.422576+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T23:59:16.707796+05:30","closed_at":"2025-12-29T23:59:16.707796+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-0ap","depends_on_id":"central-6mv","type":"parent-child","created_at":"2025-12-29T22:12:13.436574+05:30","created_by":"vivekgupta"}]}
{"id":"central-16y","title":"Login: deviceId/comments not validated (non-string may break insert)","description":"Scenario: client sends deviceId/comments as object/array or very large string.\nCurrent behavior: deviceId/comments are passed through to VgAppUserAuth.recordSession without type/length validation; Slonik may error or DB rows may become huge.\nImpact: potential 500s or unbounded storage; inconsistent data.\nDecision: validate as trimmed strings with length limits (align with app-user phone) or ignore non-strings.\nRefs: server/lib/resources/vg-app-user-auth.js login; server/lib/model/query/vg-app-user-auth.js recordSession().\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:54:21.367559+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T09:33:58.90461+05:30","closed_at":"2025-12-30T09:33:58.90461+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-16y","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.7867+05:30","created_by":"vivekgupta"}]}
{"id":"central-1aq","title":"Verify docs/vg/vg-short-token-app-users.md","notes":"GitHub:\n- gh-18 https://github.com/drguptavivek/central/issues/18\n\nSummary:\n- Verified docs/vg/vg-short-token-app-users.md aligns with implemented short-lived app user sessions.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg-short-token-app-users.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:16:09.636176+05:30","updated_at":"2025-12-29T20:05:02.858503+05:30","closed_at":"2025-12-27T13:25:17.650443+05:30","close_reason":"Verified: Design doc matches implementation.","external_ref":"gh-18"}
{"id":"central-1dl","title":"Umbrella: Telemetry semantics (idempotency + auth window)","description":"Clarify or adjust telemetry ingestion semantics: idempotency rules, empty events behavior, duplicate event ids, and acceptance after token revocation/expiry.\nGoal: predictable storage behavior and clear client guidance.\n","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-29T22:10:38.897342+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T10:42:58.135884+05:30","closed_at":"2025-12-30T10:42:58.135892+05:30"}
{"id":"central-1e5","title":"POST /projects/:projectId/app-users/telemetry: include deviceId/appUserId + invalidated status","description":"Update telemetry POST response to include deviceId and appUserId, and return a status that indicates whether the bearer token has been invalidated (revoked/deactivated/expired).\n\nImplementation notes:\n- server/lib/resources/vg-telemetry.js: after recording telemetry, re-check bearer token via Sessions.getByBearerToken(token) and set status: ok|invalidated.\n- server/lib/domain/vg-telemetry.js: return deviceId alongside inserted id/received_at so resource can echo it back.\n- server/test/integration/api/vg-telemetry.js: assert new response fields/status.\n- server/docs/vg_api.md: document response schema.\n\nFollow-ups:\n- Run server integration tests once npm deps/network are available.\n- Ensure client-side callers handle new fields/status.","notes":"GitHub:\n- gh-26 https://github.com/drguptavivek/central/issues/26\n\nSummary:\n- Updated telemetry POST response to include appUserId/deviceId and to report token invalidation status after processing.\n\nKey commits:\n- server: 482bf898 VG: telemetry response includes invalidation status\n- central: 18642ee Update: server submodule for telemetry response\n\nFiles changed:\n- server/lib/domain/vg-telemetry.js\n- server/lib/resources/vg-telemetry.js\n- server/test/integration/api/vg-telemetry.js\n- server/docs/vg_api.md\n- debug_odk_api.py\n- debug_odk_appUser.py\n\nTests:\n- server/test/integration/api/vg-telemetry.js (see commit).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T09:50:01.579293+05:30","updated_at":"2025-12-29T20:43:26.302417+05:30","closed_at":"2025-12-29T10:16:37.708445+05:30","external_ref":"gh-26","comments":[{"id":1,"issue_id":"central-1e5","author":"vivekgupta","text":"Updated POST /projects/:projectId/app-users/telemetry response schema:\n\n{\n  \"id\": 55,\n  \"appUserId\": 123,\n  \"deviceId\": \"device-1\",\n  \"dateTime\": \"2025-12-21T10:02:00.000Z\",\n  \"serverTime\": \"2025-12-21T10:02:00.500Z\",\n  \"status\": \"ok\"  // or \"invalidated\"\n}\n\nMeaning:\n- appUserId: actorId from the field_key session\n- deviceId: echoed from request payload\n- status=invalidated if bearer token no longer resolves via Sessions.getByBearerToken(token) after processing (revoked/deactivated/expired).","created_at":"2025-12-29T04:22:57Z"},{"id":2,"issue_id":"central-1e5","author":"vivekgupta","text":"Landed in git:\n- server commit: 482bf898 (VG: telemetry response includes invalidation status; also tracks debug scripts + adds server/docs/vg_api.md)\n- central commit (submodule pointer): 18642ee","created_at":"2025-12-29T04:34:29Z"},{"id":3,"issue_id":"central-1e5","author":"vivekgupta","text":"Integration tests run.  - `docker compose -f docker-compose.yml -f docker-compose.override.yml -f docker-compose.dev.yml --profile central exec service sh -lc 'cd /usr/odk \u0026\u0026 node -v \u0026\u0026  NODE_CONFIG_ENV=test BCRYPT=insecure npx --prefix server mocha test/integration/api/vg-telemetry.js' ` \n    ✔ should accept app-user telemetry and allow admin listing with filters and paging (477ms)\n    ✔ should reject non-UTC deviceDateTime (71ms)\n    ✔ should reject telemetry from non-app-user actors (38ms)\n\n  3 passing (2s)","created_at":"2025-12-29T04:46:29Z"}]}
{"id":"central-1gn","title":"Verify docs/vg/vg-server/archived_app_user_login_short_token_system.md","notes":"GitHub:\n- gh-14 https://github.com/drguptavivek/central/issues/14\n\nSummary:\n- Verified archived short-token system doc exists and matches the historical design in docs/vg/vg-server/archived_app_user_login_short_token_system.md.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg-server/archived_app_user_login_short_token_system.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:15:49.053468+05:30","updated_at":"2025-12-29T20:07:59.424066+05:30","closed_at":"2025-12-27T13:24:00.349299+05:30","close_reason":"Verified: Archive matches implementation.","external_ref":"gh-14"}
{"id":"central-1s1","title":"System settings PUT: integer parsing rejects numeric strings for ttl/cap","description":"Scenario: client sends vg_app_user_session_ttl_days or vg_app_user_session_cap as string \"3\" (common JSON form input).\nCurrent behavior: parsePositiveInt uses Number(value) and requires Number.isInteger, so \"3\" passes. (OK) Edge case: \"3.0\" passes? Number('3.0') is 3, so OK. But \"3.5\" rejects.\nImpact: coercion is permissive but may accept values with whitespace; behavior should be documented.\nDecision: document acceptable inputs or tighten to strict integers if desired.\nRefs: server/lib/resources/vg-app-user-auth.js parsePositiveInt().\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T22:04:01.623681+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T09:57:22.481344+05:30","closed_at":"2025-12-30T09:57:22.481344+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-1s1","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.789598+05:30","created_by":"vivekgupta"}]}
{"id":"central-33v","title":"Verify docs/vg/vg-server/summary_failing_tests.md","notes":"GitHub:\n- gh-13 https://github.com/drguptavivek/central/issues/13\n\nSummary:\n- Verified docs/vg/vg-server/summary_failing_tests.md is present and consistent with current test status summary.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg-server/summary_failing_tests.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:15:43.93024+05:30","updated_at":"2025-12-29T20:08:58.931149+05:30","closed_at":"2025-12-27T13:23:55.257665+05:30","close_reason":"Verified: Summary matches known state.","external_ref":"gh-13"}
{"id":"central-39u","title":"Telemetry payload appUserId ignored (document/validate)","description":"Scenario: client includes appUserId in telemetry payload (e.g., copied from earlier API response).\nCurrent behavior: appUserId is ignored; actorId comes only from bearer token. No validation or error if appUserId mismatches.\nImpact: clients may believe they can submit on behalf of other users; mismatch is silently ignored.\nDecision: reject appUserId if present or document that it is ignored.\nRefs: server/lib/domain/vg-telemetry.js recordTelemetry() input handling; server/lib/resources/vg-telemetry.js actorId derivation.\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:47:57.143554+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T00:28:29.391197+05:30","closed_at":"2025-12-30T00:28:29.391197+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-39u","depends_on_id":"central-1dl","type":"parent-child","created_at":"2025-12-29T22:12:21.46287+05:30","created_by":"vivekgupta"}]}
{"id":"central-3gl","title":"Self revoke: deviceId not validated (non-string/large payload logged)","description":"Scenario: client sends deviceId in revoke payload as object/array or huge string.\nCurrent behavior: deviceId is passed directly to audit log without validation.\nImpact: audit log may contain unexpected types or oversized values; could cause logging/storage issues.\nDecision: validate deviceId as trimmed string with length cap or ignore non-strings.\nRefs: server/lib/resources/vg-app-user-auth.js self revoke handler; server/lib/domain/vg-app-user-auth.js revokeSessions() audit details.\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T22:01:09.623998+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T10:34:29.693734+05:30","closed_at":"2025-12-30T10:34:29.693734+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-3gl","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.787683+05:30","created_by":"vivekgupta"}]}
{"id":"central-3gw","title":"Verify docs/vg/vg-server/vg_core_server_edits.md","notes":"GitHub:\n- gh-17 https://github.com/drguptavivek/central/issues/17\n\nSummary:\n- Verified docs/vg/vg-server/vg_core_server_edits.md reflects current VG server core edits.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg-server/vg_core_server_edits.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:16:04.482018+05:30","updated_at":"2025-12-29T20:05:50.021868+05:30","closed_at":"2025-12-27T13:25:12.547858+05:30","close_reason":"Verified: Core edit present in code.","external_ref":"gh-17"}
{"id":"central-3i6","title":"Verify docs/vg/vg-server/vg_settings.md","notes":"GitHub:\n- gh-7 https://github.com/drguptavivek/central/issues/7\n\nSummary:\n- Verified docs/vg/vg-server/vg_settings.md reflects current VG settings and defaults.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg-server/vg_settings.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:15:13.294886+05:30","updated_at":"2025-12-29T20:13:19.159655+05:30","closed_at":"2025-12-27T13:22:14.248877+05:30","close_reason":"Verified: Settings keys and defaults match code.","external_ref":"gh-7"}
{"id":"central-3np","title":"System settings PUT: empty payload is a no-op but returns success","description":"Scenario: client submits {} with no vg_app_user_session_ttl_days/cap/admin_pw fields.\nCurrent behavior: parsePositiveInt returns null for missing fields, promises[] stays empty, Promise.all([]) resolves, returns success.\nImpact: silent no-op; clients may expect validation error when no fields provided.\nDecision: require at least one setting or document no-op behavior.\nRefs: server/lib/resources/vg-app-user-auth.js PUT /system/settings handler.\n","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-29T22:03:56.423086+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T22:03:56.423086+05:30","dependencies":[{"issue_id":"central-3np","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.790568+05:30","created_by":"vivekgupta"}]}
{"id":"central-3r2","title":"Reset password: non-string/whitespace newPassword yields passwordWeak","description":"Scenario: admin supplies newPassword as non-string or whitespace-only string.\nCurrent behavior: isBlank() only checks null/undefined/'' so whitespace passes; ensurePasswordPolicy() returns passwordWeak for non-string/blank instead of invalidDataType/missingParameters.\nImpact: misleading error semantics for malformed input.\nDecision: validate type + trim in resource layer and return invalidDataType/missingParameters as appropriate.\nRefs: server/lib/resources/vg-app-user-auth.js reset handler; server/lib/util/util.js isBlank(); server/lib/util/vg-password.js validateVgPassword().\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:59:36.404067+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T10:24:17.51429+05:30","closed_at":"2025-12-30T10:24:17.51429+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-3r2","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.780293+05:30","created_by":"vivekgupta"}]}
{"id":"central-3x4","title":"Umbrella: Password policy alignment (max length)","description":"Align VG password policy with crypto constraints (bcrypt 72-char max) in docs and validation.\nApplies to change/reset flows.\n","status":"open","priority":3,"issue_type":"epic","created_at":"2025-12-29T22:10:49.313097+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T22:10:49.313097+05:30"}
{"id":"central-4ct","title":"System settings PUT: missing/null body throws before validation","description":"Scenario: client calls PUT /system/settings with no JSON body or explicit null.\nCurrent behavior: destructuring `const { vg_app_user_session_ttl_days, vg_app_user_session_cap, admin_pw } = body;` throws when body is undefined/null, causing 500.\nImpact: malformed requests yield server errors rather than validation responses.\nDecision: default body to {} or guard before destructuring.\nRefs: server/lib/resources/vg-app-user-auth.js PUT /system/settings handler.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:03:46.360991+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T23:23:15.434167+05:30","closed_at":"2025-12-29T23:23:15.434167+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-4ct","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.771399+05:30","created_by":"vivekgupta"}]}
{"id":"central-4d8","title":"App-user PATCH: non-string fullName/phone treated as missingParameters","description":"Scenario: client sends fullName/phone as non-strings (number/object).\nCurrent behavior: validateDisplayName/validatePhone throw missingParameters rather than invalidDataType, even though the field is present.\nImpact: inconsistent error semantics compared to other endpoints; clients get misleading 400 error.\nDecision: swap to invalidDataTypeOfParameter for type mismatches.\nRefs: server/lib/domain/vg-app-user-auth.js validateDisplayName(); server/lib/domain/vg-app-user-auth.js validatePhone().\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:57:21.803353+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T09:40:57.703712+05:30","closed_at":"2025-12-30T09:40:57.703712+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-4d8","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.781361+05:30","created_by":"vivekgupta"}]}
{"id":"central-4gs","title":"Activate/deactivate: missing/null body throws before validation","description":"Scenario: admin calls POST /projects/:projectId/app-users/:id/active with no JSON body or explicit null.\nCurrent behavior: handler reads body?.active, but body may be undefined; here it's safe due to optional chaining, but if body is null, `body?.active` is still ok. Edge case: if body is missing, it returns invalidDataType (active undefined) rather than missingParameters.\nImpact: inconsistent error semantics (invalidDataType vs missingParameters) for missing active field.\nDecision: explicitly treat missing body/active as missingParameters and document expected error.\nRefs: server/lib/resources/vg-app-user-auth.js active handler.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:03:08.178504+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T23:18:35.324247+05:30","closed_at":"2025-12-29T23:18:35.324247+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-4gs","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.772528+05:30","created_by":"vivekgupta"}]}
{"id":"central-50k","title":"Change password: non-string/whitespace old/new passwords yield misleading errors","description":"Scenario: oldPassword/newPassword provided as non-strings or whitespace-only strings.\nCurrent behavior: isBlank() only checks null/undefined/'' so whitespace passes; verifyPassword() returns false for non-string/blank -\u003e authenticationFailed; validateVgPassword() returns false for non-string/blank -\u003e passwordWeak.\nImpact: type/blank input produces auth failure/passwordWeak rather than invalidDataType or missingParameters; inconsistent with other endpoints.\nDecision: add explicit string+trim validation for oldPassword/newPassword in resource layer.\nRefs: server/lib/resources/vg-app-user-auth.js; server/lib/util/util.js isBlank(); server/lib/util/crypto.js verifyPassword(); server/lib/util/vg-password.js.\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:58:53.989898+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T09:45:18.204241+05:30","closed_at":"2025-12-30T09:45:18.204241+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-50k","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.779251+05:30","created_by":"vivekgupta"}]}
{"id":"central-5as","title":"Activate/deactivate: non-boolean active values return invalidDataType (document)","description":"Scenario: client sends active as \"true\" or 1 (string/number) instead of boolean.\nCurrent behavior: handler checks typeof active !== 'boolean' and returns invalidDataTypeOfParameter.\nImpact: clients must send strict boolean; this should be documented in vg_api.md to avoid confusion.\nDecision: document strict boolean requirement or coerce common inputs.\nRefs: server/lib/resources/vg-app-user-auth.js active handler.\n","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-29T22:03:13.379214+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T22:03:13.379214+05:30","dependencies":[{"issue_id":"central-5as","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.7857+05:30","created_by":"vivekgupta"}]}
{"id":"central-6fs","title":"Username missing from \"Show QR\" flow QR code","description":"The \"Show QR\" flow was not including the username in the generated QR code payload. This has been fixed by including the username in the general settings, so it's available when scanning the QR code in ODK Collect.\n\nFixes: client/90760f1942d37ca274f909a30150a69a79926083","notes":"GitHub:\n- gh-3 https://github.com/drguptavivek/central/issues/3\n\nSummary:\n- Added username to the \"Show QR\" flow payload so Collect receives it when scanning.\n\nKey commits:\n- client: 90760f19 Fix: Add username to QR payload for \"Show QR\" flow\n\nFiles changed:\n- client/src/components/field-key/vg-qr-panel.vue\n\nTests:\n- Not run (UI payload change only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T11:07:14.673391+05:30","updated_at":"2025-12-29T20:37:42.229888+05:30","closed_at":"2025-12-27T11:36:51.696164+05:30","close_reason":"Fixed in client commit 90760f19: Add username to QR payload","external_ref":"gh-3"}
{"id":"central-6mv","title":"Umbrella: Session lifecycle consistency \u0026 audit idempotency","description":"Address gaps where session state is inconsistent across tables or repeated actions create noisy audit logs.\nFocus: vg_app_user_sessions expiry vs core sessions, repeated revoke/activate logs, no-op revoke cases.\n","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-29T22:10:33.690516+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T22:10:33.690516+05:30"}
{"id":"central-6rx","title":"App-user PATCH: missing/null body throws before validation","description":"Scenario: client sends PATCH /projects/:projectId/app-users/:id with no JSON body or explicit `null`.\nCurrent behavior: vgAuth.updateAppUser destructures `const { fullName, phone } = payload;` and will throw when payload is undefined/null, yielding a 500.\nImpact: malformed requests cause server error instead of a 400 missingParameters/invalidEntity.\nDecision: default payload to {} in resource or guard in updateAppUser.\nRefs: server/lib/resources/app-users.js patch handler; server/lib/domain/vg-app-user-auth.js updateAppUser().\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:57:11.410788+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T23:03:03.84542+05:30","closed_at":"2025-12-29T23:03:03.84542+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-6rx","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.775386+05:30","created_by":"vivekgupta"}]}
{"id":"central-719","title":"Login: whitespace-only username/password treated as auth failure, not missing params","description":"Scenario: client submits username/password as \"   \" (whitespace).\nCurrent behavior: isBlank() returns false (non-empty string), so login proceeds; normalizeUsername() trims to '' and records a failed attempt, returning authenticationFailed.\nImpact: lockout attempts for empty username; response is 401 instead of missingParameters 400.\nDecision: treat trimmed empty strings as missingParameters at resource layer.\nRefs: server/lib/util/util.js isBlank(); server/lib/resources/vg-app-user-auth.js login; server/lib/model/query/vg-app-user-auth.js normalizeUsername().\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:54:10.951467+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T09:30:11.725201+05:30","closed_at":"2025-12-30T09:30:11.725201+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-719","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.778106+05:30","created_by":"vivekgupta"}]}
{"id":"central-729","title":"Telemetry location object requires lat/long when present (document)","description":"Scenario: payload.location is provided with only accuracy/provider (no latitude/longitude).\nCurrent behavior: parseLocation requires both latitude and longitude when location is present, otherwise 400 missingParameters.\nImpact: partial location payloads fail; clients must omit location entirely unless they have lat/long.\nDecision: document requirement in vg_api.md or relax validation.\nRefs: server/lib/domain/vg-telemetry.js parseLocation().\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:48:06.804819+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T00:31:21.673035+05:30","closed_at":"2025-12-30T00:31:21.673035+05:30","close_reason":"Covered by existing validation; added integration test to lock behavior.","dependencies":[{"issue_id":"central-729","depends_on_id":"central-1dl","type":"parent-child","created_at":"2025-12-29T22:12:21.4639+05:30","created_by":"vivekgupta"}]}
{"id":"central-75r","title":"App-user PATCH: whitespace-only phone stored as empty string","description":"Scenario: client sends phone as \"   \" (whitespace only) in PATCH payload.\nCurrent behavior: validatePhone trims and returns \"\" (empty string) rather than null; updatePhone persists empty string.\nImpact: phone field can be stored as empty string (not null), which is inconsistent with expected \"optional\" semantics and makes filtering awkward.\nDecision: treat trimmed empty as null or reject whitespace-only phone.\nRefs: server/lib/domain/vg-app-user-auth.js validatePhone(); server/lib/domain/vg-app-user-auth.js updateAppUser().\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:57:16.611786+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T09:50:11.189423+05:30","closed_at":"2025-12-30T09:50:11.189423+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-75r","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.782765+05:30","created_by":"vivekgupta"}]}
{"id":"central-8t4","title":"Telemetry listing hides rows if field_keys removed (JOIN dependency)","description":"Scenario: the field_keys row is deleted or no longer linked to the actor, but telemetry rows remain in vg_app_user_telemetry.\nCurrent behavior: GET /system/app-users/telemetry uses an INNER JOIN to field_keys, so telemetry rows for deleted field_keys are not returned.\nImpact: historical telemetry becomes inaccessible to admins; filters may appear to drop data unexpectedly.\nDecision: use LEFT JOIN + nullable projectId, or document that deletions hide telemetry history.\nRefs: server/lib/model/query/vg-telemetry.js getTelemetry() JOIN field_keys.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:47:24.452434+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T00:21:40.827669+05:30","closed_at":"2025-12-30T00:21:40.827669+05:30","close_reason":"Not applicable: Central does not delete users/projects; they are archived, so field_keys should remain. No repro in prod.","dependencies":[{"issue_id":"central-8t4","depends_on_id":"central-r6s","type":"parent-child","created_at":"2025-12-29T22:12:31.147661+05:30","created_by":"vivekgupta"}]}
{"id":"central-8vs","title":"Verify docs/vg/vg-client/vg_core_client_edits.md","notes":"GitHub:\n- gh-20 https://github.com/drguptavivek/central/issues/20\n\nSummary:\n- Verified docs/vg/vg-client/vg_core_client_edits.md is present and matches current VG client core edits.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg-client/vg_core_client_edits.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:16:19.915021+05:30","updated_at":"2025-12-29T20:02:13.661453+05:30","closed_at":"2025-12-27T13:25:42.587146+05:30","close_reason":"Verified: Client routes match doc.","external_ref":"gh-20"}
{"id":"central-8vv","title":"Telemetry project mismatch returns 404 via getByProjectAndActorId (document)","description":"Scenario: token belongs to app user in project A, but client posts to /projects/B/app-users/telemetry.\nCurrent behavior: Projects.getById + FieldKeys.getByProjectAndActorId with getOrNotFound returns 404, not 401/403.\nImpact: clients see \"not found\" rather than auth failure; may be acceptable but should be documented.\nDecision: document 404 for project mismatch or change to 403.\nRefs: server/lib/resources/vg-telemetry.js (Projects.getById, FieldKeys.getByProjectAndActorId).\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:47:46.454547+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T00:34:03.065428+05:30","closed_at":"2025-12-30T00:34:03.065428+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-8vv","depends_on_id":"central-log","type":"parent-child","created_at":"2025-12-29T22:12:04.844332+05:30","created_by":"vivekgupta"}]}
{"id":"central-8zk","title":"Telemetry list filters parseInt coercion allows non-integer ids (tighten?)","description":"Scenario: admin passes projectId/appUserId query params as \"1.9\", \"1abc\", or \"0x10\".\nCurrent behavior: parseIntParam uses Number.parseInt, so values are coerced (\"1.9\" -\u003e 1, \"1abc\" -\u003e 1, \"0x10\" -\u003e 0) instead of rejected.\nImpact: filters may hit unintended IDs without an error.\nDecision: enforce strict integer parsing (regex or Number() + Number.isInteger) or document coercion.\nRefs: server/lib/resources/vg-telemetry.js parseIntParam().\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:47:35.508344+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T00:25:47.438502+05:30","closed_at":"2025-12-30T00:25:47.438502+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-8zk","depends_on_id":"central-1dl","type":"parent-child","created_at":"2025-12-29T22:12:21.465026+05:30","created_by":"vivekgupta"}]}
{"id":"central-900","title":"Telemetry: retries without event(s) are not idempotent (duplicates)","description":"Scenario: client submits telemetry without event or events (device metadata only). Offline retries send the same payload multiple times.\nCurrent behavior: upsert only dedupes when client_event_id is non-null; for event-less payloads every retry inserts a new row (no ON CONFLICT path).\nImpact: duplicate rows in vg_app_user_telemetry; listings and analytics are inflated.\nDecision: require event id for idempotency or add an alternate dedupe key (actorId, deviceId, deviceDateTime).\nRefs: server/lib/model/query/vg-telemetry.js upsertTelemetry() ON CONFLICT clause; server/lib/domain/vg-telemetry.js recordTelemetry().\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:43:37.746306+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T23:51:00.727096+05:30","closed_at":"2025-12-29T23:51:00.727096+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-900","depends_on_id":"central-1dl","type":"parent-child","created_at":"2025-12-29T22:12:21.459901+05:30","created_by":"vivekgupta"}]}
{"id":"central-90b","title":"Self revoke: project mismatch returns 404 (document)","description":"Scenario: app user token from project A calls /projects/B/app-users/:id/revoke.\nCurrent behavior: FieldKeys.getByProjectAndActorId + getOrNotFound returns 404, not 401/403.\nImpact: clients see \"not found\" rather than auth failure; should be documented or changed.\nDecision: document 404 behavior or map to 403.\nRefs: server/lib/resources/vg-app-user-auth.js self revoke handler.\n","notes":"Documented project mismatch 404 for self-revoke in app-user-auth route docs. Test run: vg-app-user-auth integration suite passed.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T22:01:14.828641+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T11:46:38.433349+05:30","closed_at":"2025-12-30T11:46:38.433349+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-90b","depends_on_id":"central-log","type":"parent-child","created_at":"2025-12-29T22:12:04.843305+05:30","created_by":"vivekgupta"}]}
{"id":"central-a8p","title":"Lockout clear: whitespace-only username treated as missingParameters (OK but document)","description":"Scenario: admin sends username as \"   \".\nCurrent behavior: validateUsername() trims and treats empty as missingParameters.\nImpact: acceptable but should be documented as strict non-blank requirement.\nDecision: document that username is required and trimmed; whitespace-only rejected.\nRefs: server/lib/domain/vg-app-user-auth.js validateUsername(); clearLockout().\n","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-29T22:04:44.847889+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T22:04:44.847889+05:30","dependencies":[{"issue_id":"central-a8p","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.784745+05:30","created_by":"vivekgupta"}]}
{"id":"central-a9m","title":"Verify docs/vg/vg-server/vg_tests.md","notes":"GitHub:\n- gh-10 https://github.com/drguptavivek/central/issues/10\n\nSummary:\n- Verified docs/vg/vg-server/vg_tests.md matches current test guidance for VG server changes.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg-server/vg_tests.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:15:28.610535+05:30","updated_at":"2025-12-29T20:11:20.364114+05:30","closed_at":"2025-12-27T13:23:30.3435+05:30","close_reason":"Verified: Test files exist.","external_ref":"gh-10"}
{"id":"central-acn","title":"Self revoke: if auth session missing, returns success without revocation","description":"Scenario: request passes auth checks but auth.session is null (unexpected auth context or middleware bug).\nCurrent behavior: revokeSessions(currentOnly=true) skips Sessions.terminate if currentSession is null but still logs audit and returns success.\nImpact: no-op revocation with 200; might hide auth/session issues.\nDecision: treat missing currentSession as error or add explicit guard.\nRefs: server/lib/domain/vg-app-user-auth.js revokeSessions(); server/lib/resources/vg-app-user-auth.js self revoke handler.\n","notes":"Behavior change: self revoke now returns authenticationFailed if current auth session is missing. Added unit test and updated docs. Tests: unit domain/vg-app-user-auth, integration vg-app-user-auth. Commits: central-backend 0a99a3c4; central (docs) TBD.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-29T22:01:20.034464+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T12:17:22.259258+05:30","closed_at":"2025-12-30T12:17:22.259258+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-acn","depends_on_id":"central-6mv","type":"parent-child","created_at":"2025-12-29T22:12:13.438073+05:30","created_by":"vivekgupta"}]}
{"id":"central-aqy","title":"Verify docs/vg/vg-server/archived_vg_ci_checklist_app_user_login.md","notes":"GitHub:\n- gh-11 https://github.com/drguptavivek/central/issues/11\n\nSummary:\n- Verified archived CI checklist doc exists and matches historical content in docs/vg/vg-server/archived_vg_ci_checklist_app_user_login.md.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg-server/archived_vg_ci_checklist_app_user_login.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:15:33.703871+05:30","updated_at":"2025-12-29T20:10:13.616249+05:30","closed_at":"2025-12-27T13:23:35.451906+05:30","close_reason":"Verified: Archive consistent.","external_ref":"gh-11"}
{"id":"central-bq9","title":"Verify docs/vg/vg-server/vg_api.md","notes":"GitHub:\n- gh-16 https://github.com/drguptavivek/central/issues/16\n\nSummary:\n- Verified docs/vg/vg-server/vg_api.md reflects current VG API behavior.\n\nKey commits:\n- 3685721 udpated pointers\n\nFiles changed:\n- docs/vg/vg-server/vg_api.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:15:59.36002+05:30","updated_at":"2025-12-29T20:06:24.335225+05:30","closed_at":"2025-12-27T13:24:10.548133+05:30","close_reason":"Verified: API doc verified in previous step.","external_ref":"gh-16"}
{"id":"central-cc0","title":"Reset password: missing/null body throws before validation","description":"Scenario: admin calls POST /projects/:projectId/app-users/:id/password/reset with no JSON body or explicit null.\nCurrent behavior: destructuring `const { newPassword } = body;` throws when body is undefined/null, causing 500 instead of 400.\nImpact: malformed requests produce server errors rather than validation responses.\nDecision: default body to {} or guard before destructuring.\nRefs: server/lib/resources/vg-app-user-auth.js reset password handler.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:59:31.182877+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T23:09:41.621018+05:30","closed_at":"2025-12-29T23:09:41.621018+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-cc0","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.773473+05:30","created_by":"vivekgupta"}]}
{"id":"central-chc","title":"Session revoke: session hidden if field_keys deleted (JOIN dependency)","description":"Scenario: admin tries to revoke a session for an app user whose field_keys row was deleted, but vg_app_user_sessions still has rows.\nCurrent behavior: VgAppUserAuth.getSessionById uses an INNER JOIN to field_keys, so the session is not found and the endpoint returns 404.\nImpact: stale sessions cannot be revoked or audited once the field key is removed; admins lose visibility/control.\nDecision: switch to LEFT JOIN with nullable projectId or document that sessions become inaccessible after app-user deletion.\nRefs: server/lib/model/query/vg-app-user-auth.js getSessionById(); server/lib/resources/vg-app-user-auth.js session revoke handler.\n","notes":"Fix applied in server: allow session revoke after field key deletion (LEFT JOIN for session lookup), tolerate null projectId in revoke, and avoid audit actee for orphaned sessions. Added regression test and docs. GH #78 closed. Commits: central-backend 65f9fe0e; central 1c29a73, 5663a01.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T22:02:44.291294+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T11:01:19.669332+05:30","closed_at":"2025-12-30T10:54:59.242168+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-chc","depends_on_id":"central-r6s","type":"parent-child","created_at":"2025-12-29T22:12:31.149213+05:30","created_by":"vivekgupta"}]}
{"id":"central-d41","title":"Activate/deactivate: re-activating already active user still logs audit","description":"Scenario: admin posts active:true for a user already active (or active:false for already inactive).\nCurrent behavior: setActive() always logs vg.app_user.activate/deactivate and (for false) vg.app_user.sessions.revoke, even if no state change.\nImpact: audit log noise; duplicate events may confuse reporting.\nDecision: make setActive idempotent or document repeated audit entries.\nRefs: server/lib/domain/vg-app-user-auth.js setActive(); server/lib/resources/vg-app-user-auth.js active handler.\n","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-29T22:03:18.585412+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T22:03:18.585412+05:30","dependencies":[{"issue_id":"central-d41","depends_on_id":"central-6mv","type":"parent-child","created_at":"2025-12-29T22:12:13.441041+05:30","created_by":"vivekgupta"}]}
{"id":"central-doh","title":"Reset password: newPassword \u003e72 chars fails with passwordTooLong (doc mismatch)","description":"Scenario: admin sets a new password longer than 72 chars that meets VG complexity policy.\nCurrent behavior: validateVgPassword() does not enforce max length, so ensurePasswordPolicy passes; hashPassword() rejects \u003e72 with passwordTooLong.\nImpact: doc says only min length/complexity; users hit unexpected max length error.\nDecision: document 72-char max in vg_api.md or enforce max in VG policy validation.\nRefs: server/lib/util/vg-password.js validateVgPassword(); server/lib/util/crypto.js hashPassword(); server/lib/domain/vg-app-user-auth.js resetPassword().\n","notes":"Documented 72-char max for newPassword; added regression test for passwordTooLong on reset. Commits: central-backend 1680e8f7; central (docs) TBD.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:59:41.622906+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T11:25:32.758026+05:30","closed_at":"2025-12-30T11:25:32.758026+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-doh","depends_on_id":"central-3x4","type":"parent-child","created_at":"2025-12-29T22:12:41.033116+05:30","created_by":"vivekgupta"}]}
{"id":"central-eb0","title":"Telemetry: duplicate event.id within batch is last-write-wins (consider reject)","description":"Scenario: payload.events contains two items with the same id (client bug or merge conflict).\nCurrent behavior: each event is upserted; the second write overwrites the row for that (actorId, deviceId, client_event_id). Response array may include duplicate clientEventId entries even though only one row persists.\nRisk: caller thinks both events stored; only the last one wins, losing the first event details.\nDecision: validate unique event.id within a batch and 400, or document last-write-wins.\nRefs: server/lib/domain/vg-telemetry.js parseEvents(); server/lib/model/query/vg-telemetry.js upsertTelemetry().\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:43:52.966741+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T00:16:49.477737+05:30","closed_at":"2025-12-30T00:16:49.477737+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-eb0","depends_on_id":"central-1dl","type":"parent-child","created_at":"2025-12-29T22:12:21.460935+05:30","created_by":"vivekgupta"}]}
{"id":"central-ff5","title":"Revoke-admin: project mismatch returns 404 (document)","description":"Scenario: admin calls POST /projects/:projectId/app-users/:id/revoke-admin where :id is not in that project.\nCurrent behavior: FieldKeys.getByProjectAndActorId + getOrNotFound returns 404, not 403/401.\nImpact: clients see \"not found\" rather than access error; behavior should be documented or normalized.\nDecision: document 404 behavior or map to 403.\nRefs: server/lib/resources/vg-app-user-auth.js revoke-admin handler.\n","notes":"Documented revoke-admin project mismatch returns 404 in app-user-auth route docs. Tests: vg-app-user-auth integration suite passed.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T22:01:37.863877+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T11:53:24.726624+05:30","closed_at":"2025-12-30T11:53:24.726624+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-ff5","depends_on_id":"central-log","type":"parent-child","created_at":"2025-12-29T22:12:04.842293+05:30","created_by":"vivekgupta"}]}
{"id":"central-fsp","title":"Verify docs/vg/qr-code-generation.md","notes":"GitHub:\n- gh-22 https://github.com/drguptavivek/central/issues/22\n\nSummary:\n- Verified docs/vg/qr-code-generation.md matches current client implementation and documented QR code flow.\n\nKey commits:\n- 9ca1fca Doc: Add QR code generation guide from KB\n\nFiles changed:\n- docs/vg/qr-code-generation.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:16:30.171466+05:30","updated_at":"2025-12-29T20:00:47.102214+05:30","closed_at":"2025-12-27T13:25:52.798675+05:30","close_reason":"Verified: Matches verified client code.","external_ref":"gh-22"}
{"id":"central-g5r","title":"Session revoke: project mismatch returns 404 (document)","description":"Scenario: sessionId exists but belongs to a different project than :projectId in the URL.\nCurrent behavior: endpoint returns 404 (explicit check) rather than 403/401.\nImpact: clients see \"not found\" instead of authorization failure; should be documented or normalized.\nDecision: document 404 for project mismatch or change to 403.\nRefs: server/lib/resources/vg-app-user-auth.js /sessions/:sessionId/revoke handler.\n","notes":"Documented session revoke project mismatch returns 404 in app-user-sessions route docs. Tests: vg-app-user-auth integration suite passed.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T22:02:49.489434+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T11:58:20.457412+05:30","closed_at":"2025-12-30T11:58:20.457412+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-g5r","depends_on_id":"central-log","type":"parent-child","created_at":"2025-12-29T22:12:04.841148+05:30","created_by":"vivekgupta"}]}
{"id":"central-h8n","title":"Verify docs/vg/vg_git_workflow.md","notes":"GitHub:\n- gh-19 https://github.com/drguptavivek/central/issues/19\n\nSummary:\n- Verified docs/vg/vg_git_workflow.md matches current VG git workflow guidance.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg_git_workflow.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:16:14.766388+05:30","updated_at":"2025-12-29T20:04:13.365907+05:30","closed_at":"2025-12-27T13:25:22.744109+05:30","close_reason":"Verified: Workflow matches observed branches.","external_ref":"gh-19"}
{"id":"central-i8u","title":"Verify docs/vg/vg-server/vg_installation.md","notes":"GitHub:\n- gh-9 https://github.com/drguptavivek/central/issues/9\n\nSummary:\n- Verified docs/vg/vg-server/vg_installation.md matches current installation guidance for VG server setup.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg-server/vg_installation.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:15:23.504527+05:30","updated_at":"2025-12-29T20:11:53.545543+05:30","closed_at":"2025-12-27T13:22:47.470206+05:30","close_reason":"Verified: Installation steps match SQL file.","external_ref":"gh-9"}
{"id":"central-imj","title":"Telemetry: accept and store app events (event jsonb)","description":"Extend app-user telemetry so clients can send discrete app events (queued offline and replayed later) via POST /projects/:projectId/app-users/telemetry.\n\nPayload (backwards compatible):\n- Existing telemetry fields unchanged.\n- Support either:\n  - Single event: \"event\": { ... }\n  - Batch: \"events\": [{ ... }, ...] (max 10)\n\nEvent schema:\n- Required:\n  - \"id\" (client-generated stable id; string)\n  - \"type\" (string)\n- Optional:\n  - \"occurredAt\" (ISO timestamp)\n  - \"details\" (object)\n  - Any additional metadata (stored as-is)\n\nIdempotency / dedupe:\n- Uniqueness key is (appUserId/actorId, deviceId, event.id).\n- Server uses UPSERT semantics on that key so offline replays/retries don’t create duplicates.\n\nAuth/actor resolution:\n- Server must persist actorId for all telemetry rows.\n- Server should accept telemetry even if the app-user session has been invalidated/revoked/expired (offline queue).\n- Resolution policy:\n  1) Prefer resolving actorId from bearer token (even if invalidated; use token-to-actor lookup).\n  2) If token cannot be resolved, require appUserId in request body and store under that actorId (record status as invalidated/unverified).\n\nStorage:\n- vg_app_user_telemetry.event: jsonb (raw event object)\n- Add vg_app_user_telemetry.client_event_id (text) to store event.id\n- Add unique index for (actorId, device_id, client_event_id) where client_event_id is not null\n- (Optional) add derived event_type column/index later if filtering is needed.\n\nChildren:\n- DB migrations for jsonb event + client_event_id + unique index\n- Server: validate/accept batch + persist w/ upsert\n- Admin listing/tests/docs: return event fields\n","acceptance_criteria":"- Backward compatible: existing telemetry payloads (no event) still accepted.\\n- Accept single event (event) and batch (events[]) with max 10 items.\\n- Each event requires client-generated id + non-empty type.\\n- Server stores one DB row per event (no array-in-row).\\n- Server resolves/stores actorId for every row (prefers bearer token; fallback to appUserId in body if token invalidated).\\n- Requests with invalidated/revoked/expired sessions are not rejected; response indicates invalidation.\\n- Dedupe/upsert by (actorId, deviceId, clientEventId).","notes":"GitHub:\n- gh-1 https://github.com/drguptavivek/central/issues/1\n\nImplementation pointers:\n- Server commits:\n  - 894ddf9a: add vg_app_user_telemetry.event jsonb\n  - 578b4542: batching + idempotency + admin listing event\n- Central pointer commits:\n  - dc8ec6a: server pointer for 894ddf9a\n  - 294ccb9: server pointer for 578b4542\n\nRequest/behavior summary:\n- POST /v1/projects/:projectId/app-users/telemetry\n  - event (single) OR events (array, max 10)\n  - each event requires id + type\n  - 1 DB row per event; idempotency key: (actorId, deviceId, clientEventId)\n  - accepts queued uploads after session revoke; response status indicates invalidated\n- GET /v1/system/app-users/telemetry\n  - returns clientEventId + event json\n\nTests:\n- server/test/integration/api/vg-telemetry.js\n- Run via docker compose: PASS","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-29T09:58:05.852931+05:30","updated_at":"2025-12-29T20:56:41.292282+05:30","closed_at":"2025-12-29T20:56:41.292282+05:30","close_reason":"Implemented in server submodule; central pointer already at 578b4542","external_ref":"gh-1"}
{"id":"central-imj.1","title":"DB: add event jsonb to vg_app_user_telemetry","description":"Add nullable jsonb column (event) to vg_app_user_telemetry, plus any needed indexes (optional: derived event_type text + index if we want filter/search). Ensure migration path matches how vg tables are managed in this fork (knex migration vs manual SQL docs).","notes":"GitHub:\n- gh-27 https://github.com/drguptavivek/central/issues/27\n\nSummary:\n- Added event jsonb column for app-user telemetry storage.\n\nKey commits:\n- server: 894ddf9a vg: add telemetry event jsonb column\n- central: dc8ec6a Update: server submodule (telemetry event jsonb)\n\nFiles changed:\n- server/docs/sql/vg_app_user_auth.sql\n- server/test/integration/fixtures/03-vg-app-user-auth.js\n\nTests:\n- Not run (schema/fixture change only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T09:59:30.544963+05:30","updated_at":"2025-12-29T20:44:07.32644+05:30","closed_at":"2025-12-29T10:32:42.670194+05:30","close_reason":"Implemented + applied migration: added nullable jsonb 'event' column to vg_app_user_telemetry","external_ref":"gh-27","dependencies":[{"issue_id":"central-imj.1","depends_on_id":"central-imj","type":"parent-child","created_at":"2025-12-29T09:59:30.545786+05:30","created_by":"vivekgupta"}],"comments":[{"id":4,"issue_id":"central-imj.1","author":"vivekgupta","text":"EDITED -  server/docs/sql/vg_app_user_auth.sql\n\n-- App-user telemetry data (device metadata, location, timestamps).\nCREATE TABLE IF NOT EXISTS vg_app_user_telemetry (\n  id bigserial PRIMARY KEY,\n  \"actorId\" integer NOT NULL REFERENCES actors(id) ON DELETE CASCADE,\n  device_id text NOT NULL,\n  collect_version text NOT NULL,\n  device_date_time timestamptz NOT NULL,\n  received_at timestamptz NOT NULL DEFAULT now(),\n  **event jsonb NULL,**\n  location_lat double precision NULL,\n  location_lng double precision NULL,\n  location_altitude double precision NULL,\n  location_accuracy double precision NULL,\n  location_speed double precision NULL,\n  location_bearing double precision NULL,\n  location_provider text NULL\n);\nALTER TABLE IF EXISTS vg_app_user_telemetry\n  ADD COLUMN IF NOT EXISTS event jsonb; \n\nAPPLIED MIGRATION\n  RAN - `docker exec -i central-postgres14-1 psql -U odk -d odk \u003c server/docs/sql/vg_app_user_auth.sql`","created_at":"2025-12-29T04:58:23Z"}]}
{"id":"central-imj.2","title":"Server: accept/validate event payload and persist","description":"Implement server-side support for batched, idempotent app-event telemetry ingestion.\n\nRequest parsing:\n- Support either \"event\" (single object) or \"events\" (array).\n- Normalize to an array of events.\n- Enforce max batch size: 10.\n\nValidation (per event):\n- event must be an object.\n- event.id: required non-empty string (client-generated stable id).\n- event.type: required non-empty string.\n- Optional occurredAt: ISO timestamp string.\n- Enforce size limits (per-event + total request) to prevent oversized jsonb writes.\n\nActor resolution:\n- Always store an actorId for each telemetry row.\n- Resolve actorId from bearer token when possible.\n- If bearer token cannot be resolved because session is invalidated/revoked/expired, do NOT reject; instead require appUserId in body and store under that actorId (and return status=invalidated/unverified).\n\nPersistence:\n- Write one DB row per event.\n- Store raw event object in vg_app_user_telemetry.event.\n- Store event.id in vg_app_user_telemetry.client_event_id.\n- Insert using upsert logic keyed by (actorId, device_id, client_event_id).\n  - Decide DO UPDATE vs DO NOTHING; DO UPDATE recommended so retries can repair incomplete rows.\n\nResponse:\n- 200 OK\n- For batches: return an array of per-event results (at least clientEventId + stored row id + status).\n\nTests:\n- Batch of 2-3 events inserts multiple rows.\n- Replay (same client_event_id) does not duplicate (upsert works).\n- Invalidated token path still stores events when appUserId provided.\n","acceptance_criteria":"- Accepts both {event} and {events:[...]} (max 10).\\n- Validates event.id and event.type (non-empty strings) and enforces payload size limits.\\n- Persists one row per event with actorId, device_id, client_event_id, event jsonb.\\n- Uses upsert/dedupe on (actorId, device_id, client_event_id).\\n- Does not reject queued telemetry from invalidated/revoked/expired sessions; returns status to indicate invalidation.","notes":"GitHub:\n- gh-28 https://github.com/drguptavivek/central/issues/28\n\nSummary:\n- Implemented batched telemetry event ingestion (max 10), per-event validation, idempotent UPSERT by client event id, and acceptance of revoked/expired tokens with invalidated status.\n\nKey commits:\n- server: 578b4542 vg: batched telemetry events with idempotency\n- central: 294ccb9 Update: server submodule (batched telemetry events)\n\nFiles changed:\n- server/lib/domain/vg-telemetry.js\n- server/lib/resources/vg-telemetry.js\n- server/lib/model/query/vg-telemetry.js\n- server/lib/model/query/vg-app-user-auth.js\n- server/lib/http/service.js\n- server/test/integration/api/vg-telemetry.js\n- server/docs/sql/vg_app_user_auth.sql\n- server/test/integration/fixtures/03-vg-app-user-auth.js\n\nTests:\n- docker compose ... npx --prefix server mocha test/integration/api/vg-telemetry.js (PASS)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T09:59:40.90706+05:30","updated_at":"2025-12-29T20:45:00.165376+05:30","closed_at":"2025-12-29T19:24:58.143946+05:30","close_reason":"Implemented batched events (max 10), validation, actor resolution via vg_app_user_sessions even after session revocation, and UPSERT dedupe.","external_ref":"gh-28","dependencies":[{"issue_id":"central-imj.2","depends_on_id":"central-imj","type":"parent-child","created_at":"2025-12-29T09:59:40.908128+05:30","created_by":"vivekgupta"},{"issue_id":"central-imj.2","depends_on_id":"central-imj.1","type":"blocks","created_at":"2025-12-29T10:00:05.061227+05:30","created_by":"vivekgupta"},{"issue_id":"central-imj.2","depends_on_id":"central-imj.4","type":"blocks","created_at":"2025-12-29T19:07:07.758838+05:30","created_by":"vivekgupta"}]}
{"id":"central-imj.3","title":"Admin listing/tests/docs: return event","description":"Update admin telemetry listing to return stored app events and related metadata.\n\nAPI:\n- Extend GET /system/app-users/telemetry to include:\n  - event (json)\n  - clientEventId (from client_event_id)\n  - (Optional) auth status indicating whether upload was from an invalidated session\n\nTests:\n- Ensure stored event is returned verbatim.\n- Ensure clientEventId is returned.\n\nDocs:\n- Update server/docs/vg_api.md with request/response examples for:\n  - single-event telemetry\n  - batched telemetry (max 10)\n  - dedupe/upsert semantics (idempotency key)\n","acceptance_criteria":"- Admin listing includes event jsonb and client_event_id for each telemetry row.\\n- (If implemented) listing includes auth status (ok/invalidated/unverified) so admins can understand queued uploads.\\n- Integration tests cover returning stored event + client_event_id.\\n- Docs updated (server/docs/vg_api.md and optionally api.yaml).","notes":"GitHub:\n- gh-29 https://github.com/drguptavivek/central/issues/29\n\nSummary:\n- Extended admin telemetry listing to return stored event json and clientEventId; added integration coverage.\n\nKey commits:\n- server: 578b4542 vg: batched telemetry events with idempotency\n- central: 294ccb9 Update: server submodule (batched telemetry events)\n\nFiles changed:\n- server/lib/model/query/vg-telemetry.js\n- server/lib/resources/vg-telemetry.js\n- server/test/integration/api/vg-telemetry.js\n\nTests:\n- docker compose ... npx --prefix server mocha test/integration/api/vg-telemetry.js (PASS)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T09:59:51.241875+05:30","updated_at":"2025-12-29T20:49:49.636427+05:30","closed_at":"2025-12-29T19:25:08.399164+05:30","close_reason":"Admin telemetry listing now returns event json + clientEventId; added integration tests.","external_ref":"gh-29","dependencies":[{"issue_id":"central-imj.3","depends_on_id":"central-imj","type":"parent-child","created_at":"2025-12-29T09:59:51.242762+05:30","created_by":"vivekgupta"},{"issue_id":"central-imj.3","depends_on_id":"central-imj.2","type":"blocks","created_at":"2025-12-29T10:00:15.329628+05:30","created_by":"vivekgupta"}]}
{"id":"central-imj.4","title":"DB: add client_event_id + unique index for telemetry idempotency","description":"Add columns/indexes needed for idempotent, batched telemetry events.\n\nChange:\n- Add nullable column: vg_app_user_telemetry.client_event_id text\n  - Stores client-generated event.id.\n- Add unique index to support UPSERT/dedupe:\n  - UNIQUE (\"actorId\", device_id, client_event_id) WHERE client_event_id IS NOT NULL\n\nNotes:\n- Keep backwards compatibility: existing rows without client_event_id remain valid.\n- Column/index should be added to:\n  - server/docs/sql/vg_app_user_auth.sql\n  - server/test/integration/fixtures/03-vg-app-user-auth.js\n","notes":"GitHub:\n- gh-30 https://github.com/drguptavivek/central/issues/30\n\nSummary:\n- Added client_event_id and a partial unique index to support idempotent telemetry event storage.\n\nKey commits:\n- server: 578b4542 vg: batched telemetry events with idempotency\n- central: 294ccb9 Update: server submodule (batched telemetry events)\n\nFiles changed:\n- server/docs/sql/vg_app_user_auth.sql\n- server/test/integration/fixtures/03-vg-app-user-auth.js\n\nTests:\n- Not run (schema/fixture change only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T19:06:53.215113+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T20:50:25.173778+05:30","closed_at":"2025-12-29T19:24:47.912314+05:30","close_reason":"Added client_event_id + unique index for idempotent telemetry events (docs/sql + test fixtures).","external_ref":"gh-30","dependencies":[{"issue_id":"central-imj.4","depends_on_id":"central-imj","type":"parent-child","created_at":"2025-12-29T19:06:53.216354+05:30","created_by":"vivekgupta"}]}
{"id":"central-izx","title":"Telemetry: revoked/expired token still accepted if session row exists (define policy)","description":"Scenario: app user token is revoked or expired in core sessions, but the matching row in vg_app_user_sessions remains (no cleanup or expiry filter).\nCurrent behavior: POST /projects/:projectId/app-users/telemetry authenticates via VgAppUserAuth.getSessionByToken() without checking expires_at, records telemetry, then marks status \"invalidated\" if Sessions.getByBearerToken() returns empty.\nImpact: very old or revoked tokens can still post telemetry and create rows; may be intended for offline queues but should be explicitly bounded.\nDecision: enforce expires_at in VgAppUserAuth.getSessionByToken(), or add a grace window, or document acceptance of invalidated tokens.\nRefs: server/lib/model/query/vg-app-user-auth.js getSessionByToken(); server/lib/resources/vg-telemetry.js invalidated check.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:47:14.20992+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T00:13:04.014672+05:30","closed_at":"2025-12-30T00:13:04.014672+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-izx","depends_on_id":"central-1dl","type":"parent-child","created_at":"2025-12-29T22:12:21.461916+05:30","created_by":"vivekgupta"}]}
{"id":"central-jh0","title":"Verify docs/vg/vg-server/vg_overview.md","notes":"GitHub:\n- gh-8 https://github.com/drguptavivek/central/issues/8\n\nSummary:\n- Verified docs/vg/vg-server/vg_overview.md reflects current VG server overview and defaults.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg-server/vg_overview.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:15:18.397079+05:30","updated_at":"2025-12-29T20:12:45.775381+05:30","closed_at":"2025-12-27T13:22:42.371834+05:30","close_reason":"Verified: Overview matches schema and defaults.","external_ref":"gh-8"}
{"id":"central-jpt","title":"Verify docs/vg/vg-server/vg_user_behavior.md","notes":"GitHub:\n- gh-15 https://github.com/drguptavivek/central/issues/15\n\nSummary:\n- Verified docs/vg/vg-server/vg_user_behavior.md aligns with current app-user behavior.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg-server/vg_user_behavior.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:15:54.187387+05:30","updated_at":"2025-12-29T20:06:59.552861+05:30","closed_at":"2025-12-27T13:24:05.447486+05:30","close_reason":"Verified: Behavior matches API and code.","external_ref":"gh-15"}
{"id":"central-kjm","title":"Telemetry: empty events[] treated as single row with null client_event_id (clarify/validate)","description":"Scenario: client sends POST /projects/:projectId/app-users/telemetry with events: [] (explicit empty array) and no event field.\nCurrent behavior: parseEvents() returns [], recordTelemetry() treats it as no events and inserts a single row with client_event_id=null. Because payload.events is an array, the resource treats it as a batch and returns an array with one result.\nPotential issue: caller might expect a 400 or zero rows when events[] is empty; also idempotency is lost because client_event_id is null.\nDecision: reject empty events[] or explicitly document this behavior in vg_api.md.\nRefs: server/lib/domain/vg-telemetry.js parseEvents()/recordTelemetry(); server/lib/resources/vg-telemetry.js hasBatch handling.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:43:32.730191+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T23:47:05.915681+05:30","closed_at":"2025-12-29T23:47:05.915681+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-kjm","depends_on_id":"central-1dl","type":"parent-child","created_at":"2025-12-29T22:12:21.458497+05:30","created_by":"vivekgupta"}]}
{"id":"central-ku4","title":"Update telemetry UI to show events","description":"Update VG telemetry table/map to display event fields (id/type/occurredAt/details) returned by /system/app-users/telemetry.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:15:19.152425+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T21:17:40.957969+05:30","closed_at":"2025-12-29T21:17:40.957969+05:30","close_reason":"Updated client telemetry UI to display event data"}
{"id":"central-kxg","title":"Session revoke: repeated revoke logs duplicate audit entries","description":"Scenario: admin revokes the same session multiple times (or the session already expired).\nCurrent behavior: revokeSessionById always sets expires_at to now and logs vg.app_user.sessions.revoke again, even if already revoked/expired.\nImpact: audit noise and ambiguous session history; no idempotent behavior.\nDecision: make revoke idempotent (skip if already expired) or document that multiple audit entries are expected.\nRefs: server/lib/domain/vg-app-user-auth.js revokeSessionById(); server/lib/model/query/vg-app-user-auth.js getSessionById().\n","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-29T22:02:54.699031+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T13:21:49.757157+05:30","closed_at":"2025-12-30T13:21:49.757157+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-kxg","depends_on_id":"central-6mv","type":"parent-child","created_at":"2025-12-29T22:12:13.439133+05:30","created_by":"vivekgupta"}]}
{"id":"central-lgf","title":"Login: missing JSON body can throw before validation","description":"Scenario: client calls POST /projects/:projectId/app-users/login with no JSON body (body undefined).\nCurrent behavior: destructuring `const { username, password } = body;` throws before validation, leading to 500.\nImpact: malformed requests cause server error instead of 400 missingParameters.\nDecision: default body to {} like telemetry endpoint or guard before destructuring.\nRefs: server/lib/resources/vg-app-user-auth.js login handler.\n","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:54:16.157229+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T09:28:10.915166+05:30","closed_at":"2025-12-30T09:28:10.915166+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-lgf","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.776339+05:30","created_by":"vivekgupta"}]}
{"id":"central-log","title":"Umbrella: Project scoping error semantics (404 vs 403)","description":"Normalize or document how VG endpoints respond when :projectId does not match the actor/session or resource.\nGoal: consistent behavior across telemetry, revoke, session revoke, activate/deactivate.\n","status":"open","priority":3,"issue_type":"epic","created_at":"2025-12-29T22:10:28.497313+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T22:10:28.497313+05:30"}
{"id":"central-mbu","title":"Update vg_api telemetry event docs","description":"Update docs/vg/vg-server/vg_api.md to document telemetry event payloads (event/events), idempotency, actor resolution, response fields, and admin listing fields.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:00:46.202808+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T21:02:42.082703+05:30","closed_at":"2025-12-29T21:02:42.082703+05:30","close_reason":"Updated vg_api telemetry event docs"}
{"id":"central-o3z","title":"Change password: missing/null body throws before validation","description":"Scenario: client calls POST /projects/:projectId/app-users/:id/password/change with no JSON body or explicit null.\nCurrent behavior: destructuring `const { oldPassword, newPassword } = body;` throws when body is undefined/null, leading to 500 instead of 400.\nImpact: malformed requests produce server errors rather than user-facing validation.\nDecision: default body to {} or guard before destructuring.\nRefs: server/lib/resources/vg-app-user-auth.js change password handler.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:58:48.779753+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T23:06:22.165729+05:30","closed_at":"2025-12-29T23:06:22.165729+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-o3z","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.774424+05:30","created_by":"vivekgupta"}]}
{"id":"central-ore","title":"Central service startup hang - RCA needed","notes":"GitHub:\n- gh-24 https://github.com/drguptavivek/central/issues/24\n\nSummary:\n- Investigated central service startup hang; root cause was nginx stale DNS cache after service container restart. Resolution: docker compose restart nginx.\n\nKey commits:\n- None (operational fix only).\n\nFiles changed:\n- None.\n\nTests:\n- Not run (operational fix).","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-27T23:55:18.056799+05:30","updated_at":"2025-12-29T19:59:40.701949+05:30","closed_at":"2025-12-27T23:59:02.665918+05:30","close_reason":"Resolved: Nginx stale DNS cache after service container restart. Fix: docker compose restart nginx","external_ref":"gh-24"}
{"id":"central-qtg","title":"Show User device teleemtry on map","description":"I want to see the telemtry ifnormation ofopr each user deivce on a map. Each filter by device amd ate range. I am leaning towards use of leaf;et for map display","notes":"GitHub:\n- gh-2 https://github.com/drguptavivek/central/issues/2\n\nSummary:\n- Implemented an app-user telemetry view with a map-based display and filtering to visualize device telemetry by user and date range.\n\nKey commits:\n- client: 5e9a1b2b UI: ... added telemetry tab\n- client: fc57b069 Add: Telemetry map view with OpenLayers\n\nFiles changed:\n- client/src/components/project/vg-telemetry.vue\n- client/src/components/project/vg-telemetry-map-view.vue\n- client/src/components/project/vg-telemetry-map-popup.vue\n- client/src/util/load-async.js\n- client/src/util/request.js\n\nTests:\n- Not run (UI feature work).","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-26T11:54:57.548518+05:30","updated_at":"2025-12-29T20:40:45.450869+05:30","closed_at":"2025-12-26T12:13:18.062787+05:30","close_reason":"Closed","external_ref":"gh-2"}
{"id":"central-qtj","title":"Lockout clear: non-string ip returns missingParameters (misleading)","description":"Scenario: admin passes ip as non-string (number/object).\nCurrent behavior: normalizeIp() throws missingParameters instead of invalidDataType even though ip is provided.\nImpact: misleading error semantics for malformed input.\nDecision: switch to invalidDataType for non-string ip or validate in resource layer.\nRefs: server/lib/domain/vg-app-user-auth.js normalizeIp(); clearLockout().\n","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-29T22:04:39.640024+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T22:04:39.640024+05:30","dependencies":[{"issue_id":"central-qtj","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.783776+05:30","created_by":"vivekgupta"}]}
{"id":"central-qx8","title":"Revoke-admin: repeated revoke is not idempotent in audit","description":"Scenario: admin calls revoke-admin multiple times for already inactive app user.\nCurrent behavior: setActive(false) always logs vg.app_user.sessions.revoke and vg.app_user.deactivate, even if vg_active already false.\nImpact: audit log noise and repeated revoke events; may be confusing to auditors.\nDecision: make setActive idempotent (no-op if already false) or document repeated audit entries.\nRefs: server/lib/domain/vg-app-user-auth.js setActive(); server/lib/resources/vg-app-user-auth.js revoke-admin handler.\n","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-29T22:01:43.051626+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T13:21:49.806503+05:30","closed_at":"2025-12-30T13:21:49.806503+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-qx8","depends_on_id":"central-6mv","type":"parent-child","created_at":"2025-12-29T22:12:13.440098+05:30","created_by":"vivekgupta"}]}
{"id":"central-qyo","title":"Verify docs/vg/vg-server/archived_cmds.md","notes":"GitHub:\n- gh-6 https://github.com/drguptavivek/central/issues/6\n\nSummary:\n- Verified archived commands doc exists in docs/vg/vg-server/archived_cmds.md and matches expected references.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg-server/archived_cmds.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:15:06.311766+05:30","updated_at":"2025-12-29T20:13:59.642555+05:30","closed_at":"2025-12-27T13:20:22.406253+05:30","close_reason":"Verified: Archived doc points to existing SQL file.","external_ref":"gh-6"}
{"id":"central-qzg","title":"Login: project mismatch does not count toward lockout","description":"Scenario: username exists but client posts to wrong projectId in URL.\nCurrent behavior: login returns authenticationFailed with reason project_mismatch but does not call recordAttempt(), so it doesn't count toward lockout thresholds.\nImpact: repeated cross-project login attempts do not trigger lockout; may be OK but should be explicit.\nDecision: decide whether project mismatch should count as failure or document this behavior.\nRefs: server/lib/domain/vg-app-user-auth.js login() projectId mismatch branch.\n","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-29T21:54:31.77376+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T21:54:31.77376+05:30","dependencies":[{"issue_id":"central-qzg","depends_on_id":"central-v6u","type":"parent-child","created_at":"2025-12-29T22:12:49.334467+05:30","created_by":"vivekgupta"}]}
{"id":"central-qzn","title":"Umbrella: VG API input validation \u0026 body handling","description":"Group validation gaps across VG endpoints (missing/null body handling, type/whitespace validation, string length constraints, query param coercion).\nGoal: ensure malformed input yields consistent 400s (invalidDataType/missingParameters) and avoid 500s.\nLikely to touch multiple resources in server/lib/resources/* and domain validators.\n","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-29T22:10:23.294639+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T22:10:23.294639+05:30"}
{"id":"central-r6s","title":"Umbrella: Field-key deletion impact on telemetry/session visibility","description":"Handle cases where vg_* history exists but field_keys rows are deleted; current joins hide telemetry or prevent session revocation.\nGoal: decide whether to preserve visibility (LEFT JOIN) or document data loss.\n","status":"closed","priority":3,"issue_type":"epic","created_at":"2025-12-29T22:10:44.107947+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T00:23:42.579818+05:30","closed_at":"2025-12-30T00:23:42.579818+05:30","close_reason":"Not applicable: Central does not delete users/projects; they are archived, so field_keys should remain. Related tasks closed."}
{"id":"central-rai","title":"Add app user permission for GET /v1/projects/{id}","description":"Allow app user actors to access project details endpoint","notes":"GitHub:\n- gh-25 https://github.com/drguptavivek/central/issues/25\n\nSummary:\n- Allowed app-user (field_key) actors to read project details via GET /v1/projects/:id with project-scoped validation.\n\nKey commits:\n- server: f6ccde9b Add app user access to GET /v1/projects/:id\n- central: 0a226c1 Update: server with app user project read access\n\nFiles changed:\n- server/lib/resources/projects.js\n- server/lib/model/query/field-keys.js\n\nTests:\n- Not run (authorization change).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T00:01:05.309566+05:30","updated_at":"2025-12-29T20:41:41.493356+05:30","closed_at":"2025-12-28T00:13:10.9566+05:30","close_reason":"Implemented app user access to GET /v1/projects/:id. Modified projects.js to check if actor is field_key and belongs to project. Added getByActorId to field-keys.js. App users get basic data only (no extended metadata).","external_ref":"gh-25"}
{"id":"central-rzc","title":"Change password: newPassword \u003e72 chars fails with passwordTooLong (doc mismatch)","description":"Scenario: user supplies a new password longer than 72 characters but meeting VG complexity rules.\nCurrent behavior: validateVgPassword() does not enforce max length, so ensurePasswordPolicy passes; hashPassword() rejects \u003e72 with passwordTooLong.\nImpact: users see a passwordTooLong error not documented in VG password policy (which only mentions min length and complexity).\nDecision: document 72-char max in vg_api.md or enforce max in VG policy validator.\nRefs: server/lib/util/vg-password.js validateVgPassword(); server/lib/util/crypto.js hashPassword(); server/lib/domain/vg-app-user-auth.js changePassword().\n","notes":"Documented 72-char max for newPassword; added regression test for passwordTooLong on change. Commits: central-backend 1680e8f7; central (docs) TBD.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:58:59.205462+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T11:25:32.75683+05:30","closed_at":"2025-12-30T11:25:32.75683+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-rzc","depends_on_id":"central-3x4","type":"parent-child","created_at":"2025-12-29T22:12:41.031774+05:30","created_by":"vivekgupta"}]}
{"id":"central-thb","title":"Update docs/vg to match submodule changes","notes":"GitHub:\n- gh-5 https://github.com/drguptavivek/central/issues/5\n\nSummary:\n- Moved VG docs into central/docs/vg/ and aligned documentation with submodule changes.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n- 3685721 udpated pointers\n\nFiles changed:\n- docs/vg/**\n- submodule pointers (client/server)\n\nTests:\n- Not run (doc organization update).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T11:29:52.097983+05:30","updated_at":"2025-12-29T20:16:13.651292+05:30","closed_at":"2025-12-27T11:35:44.944526+05:30","close_reason":"Moved VG docs to central/docs/vg/ and updated submodules","external_ref":"gh-5"}
{"id":"central-tun","title":"Login: lockout behavior shifts if request.ip missing","description":"Scenario: deployments behind proxy misconfigured so request.ip is empty/null.\nCurrent behavior: lockout queries omit ip filter when ip is null, making lockouts username-only instead of username+IP.\nImpact: rate limiting becomes broader than intended; could lock out legitimate users sharing username.\nDecision: document dependency on trusted proxy settings or require IP for lockout logic.\nRefs: server/lib/domain/vg-app-user-auth.js getLock(); server/lib/model/query/vg-app-user-auth.js getLockStatus().\n","notes":"Fix: scope lockout status/clears to null ip rows when request ip is missing; added regression test. Lockout clear now accepts ip to clear specific IP. Docs updated. Commits: central-backend ff87b220.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:54:26.571623+05:30","created_by":"vivekgupta","updated_at":"2025-12-30T11:09:52.290105+05:30","closed_at":"2025-12-30T11:09:52.290105+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-tun","depends_on_id":"central-v6u","type":"parent-child","created_at":"2025-12-29T22:12:49.333027+05:30","created_by":"vivekgupta"}]}
{"id":"central-uls","title":"App Users Can Read Project Details via GET /v1/projects/{id}","description":"\n\n## Summary\nImplemented support for app users (field_keys) to read project details via the GET /v1/projects/{id} endpoint.\n\n## Implementation Details\n\n### Changes Made\n1. **server/docs/sql/vg_app_user_auth.sql**\n   - Added UPDATE statement to grant 'project.read' verb to app-user role\n   - Commit: 87a62efd\n\n2. **server/lib/model/query/auth.js** \n   - Added special authorization logic for field_keys (app users)\n   - App users can now read a project if they have assignment to any form in that project\n   - Maintains security by checking form-level assignments\n   - Commit: ebb671bd\n\n### How It Works\n- App users are field_keys in the system, not web users\n- They have assignments to forms, not projects\n- Added special case in can() function that checks:\n  1. Actor is a field_key\n  2. Requesting project.read permission\n  3. Has access to at least one form in the project via form assignments\n- This allows Collect app to fetch project metadata while maintaining security\n\n### Testing\n- App users can now call: GET /v1/projects/{id}\n- Returns project details (name, description, metadata)\n- Access is limited to projects they have form access to\n","notes":"GitHub:\n- gh-23 https://github.com/drguptavivek/central/issues/23\n\nSummary:\n- Allowed app-user (field_key) actors to read project details via GET /v1/projects/:id by granting project.read and adding field_key authorization logic.\n\nKey commits:\n- server: 87a62efd Fix: Grant app users permission to read project details\n- server: ebb671bd Fix: Allow app users to read project details\n\nFiles changed:\n- server/docs/sql/vg_app_user_auth.sql\n- server/lib/model/query/auth.js\n\nTests:\n- Not run (authorization change).","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T23:33:19.74866+05:30","updated_at":"2025-12-29T20:42:26.552433+05:30","closed_at":"2025-12-29T09:49:43.232224+05:30","external_ref":"gh-23"}
{"id":"central-uro","title":"Verify docs/vg/vg-client/vg_client_changes.md","notes":"GitHub:\n- gh-21 https://github.com/drguptavivek/central/issues/21\n\nSummary:\n- Verified docs/vg/vg-client/vg_client_changes.md reflects current VG client changes and matches codebase.\n\nKey commits:\n- 69ef7be Doc: Centralize VG documentation and update submodules\n\nFiles changed:\n- docs/vg/vg-client/vg_client_changes.md\n\nTests:\n- Not run (doc verification only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:16:25.041219+05:30","updated_at":"2025-12-29T20:01:38.962901+05:30","closed_at":"2025-12-27T13:25:47.689403+05:30","close_reason":"Verified: Recently updated summary.","external_ref":"gh-21"}
{"id":"central-v6u","title":"Umbrella: Login/lockout policy consistency","description":"Capture login/lockout edge cases that affect rate limiting semantics (IP handling, project mismatch handling).\nGoal: clarify intended lockout behavior and document or adjust implementation.\n","status":"open","priority":3,"issue_type":"epic","created_at":"2025-12-29T22:11:37.470846+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T22:11:37.470846+05:30"}
{"id":"central-w1a","title":"App-user PATCH: empty payload is a no-op but still audits","description":"Scenario: PATCH payload is {} or has no fullName/phone fields.\nCurrent behavior: updateAppUser performs no DB updates but still logs vg.app_user.update audit with undefined fields.\nImpact: audit noise and implicit no-op behavior; clients may expect 400 for \"no fields to update\".\nDecision: enforce at least one of fullName/phone or document no-op.\nRefs: server/lib/domain/vg-app-user-auth.js updateAppUser(); server/lib/resources/app-users.js patch handler.\n","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-29T21:57:27.002437+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T21:57:27.002437+05:30","dependencies":[{"issue_id":"central-w1a","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.791507+05:30","created_by":"vivekgupta"}]}
{"id":"central-w4f","title":"System settings PUT: admin_pw accepts any length (no max)","description":"Scenario: client sets admin_pw to extremely long string.\nCurrent behavior: only checks non-empty string; no max length or complexity enforced.\nImpact: potential oversized config values; unclear password policy for admin_pw.\nDecision: add length cap/validation or document lack of constraints.\nRefs: server/lib/resources/vg-app-user-auth.js PUT /system/settings handler.\n","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-29T22:04:06.797447+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T22:04:06.797447+05:30","dependencies":[{"issue_id":"central-w4f","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.788635+05:30","created_by":"vivekgupta"}]}
{"id":"central-x0u","title":"Login: non-string username/password can throw before 400 (validate types)","description":"Scenario: client posts username or password as object/number (e.g., {\"username\": {\"a\":1}, \"password\": 123}).\nCurrent behavior: isBlank() only checks null/undefined/''; non-strings pass. normalizeUsername() calls trim() and can throw TypeError, leading to 500 instead of 400.\nImpact: malformed input causes server error rather than a clean validation response.\nDecision: add explicit string type validation in login resource or normalizeUsername() guard.\nRefs: server/lib/resources/vg-app-user-auth.js login; server/lib/model/query/vg-app-user-auth.js normalizeUsername().\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:54:05.745066+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T22:56:03.213022+05:30","closed_at":"2025-12-29T22:56:03.213022+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-x0u","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.777243+05:30","created_by":"vivekgupta"}]}
{"id":"central-x5p","title":"Activate/deactivate: project mismatch returns 404 (document)","description":"Scenario: admin calls /projects/:projectId/app-users/:id/active where :id is not in that project.\nCurrent behavior: FieldKeys.getByProjectAndActorId + getOrNotFound returns 404.\nImpact: clients see \"not found\" rather than 403/401; should be documented or normalized.\nDecision: document 404 behavior or map to 403.\nRefs: server/lib/resources/vg-app-user-auth.js active handler.\n","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-29T22:03:23.794312+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T22:03:23.794312+05:30","dependencies":[{"issue_id":"central-x5p","depends_on_id":"central-log","type":"parent-child","created_at":"2025-12-29T22:12:04.839573+05:30","created_by":"vivekgupta"}]}
{"id":"central-xge","title":"Managed QR code payload exceeds capacity and causes truncation","description":"The payload for managed QR codes was too large, exceeding QR code capacity and causing data truncation. The payload has been optimized by removing unnecessary settings and simplifying others to ensure it fits.\n\nFixes: client/0e707d61f7bcd2b002b1595d745fc8a943a55b59","notes":"GitHub:\n- gh-4 https://github.com/drguptavivek/central/issues/4\n\nSummary:\n- Optimized managed QR payload to avoid capacity overflows by trimming unnecessary fields/settings.\n\nKey commits:\n- client: 0e707d61 Fix: Optimize Managed QR payload to fit within QR code capacity\n\nFiles changed:\n- client/src/components/field-key/vg-qr-panel.vue\n\nTests:\n- Not run (UI payload change only).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T11:07:23.654973+05:30","updated_at":"2025-12-29T20:17:51.008245+05:30","closed_at":"2025-12-27T11:36:46.527573+05:30","close_reason":"Fixed in client commit 0e707d61: Optimize Managed QR payload","external_ref":"gh-4"}
{"id":"central-xsw","title":"Lockout clear: missing/null body throws before validation","description":"Scenario: admin calls POST /system/app-users/lockouts/clear with no JSON body or explicit null.\nCurrent behavior: vgAuth.clearLockout() receives undefined/null payload; validateUsername() tries typeof username on undefined and throws missingParameters, but may throw earlier if payload is undefined when accessing payload.username.\nImpact: malformed requests can produce 500 or misleading error responses.\nDecision: default body to {} in resource layer and validate username explicitly.\nRefs: server/lib/resources/vg-app-user-auth.js lockout clear handler; server/lib/domain/vg-app-user-auth.js clearLockout(); validateUsername().\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:04:34.432477+05:30","created_by":"vivekgupta","updated_at":"2025-12-29T23:13:26.235997+05:30","closed_at":"2025-12-29T23:13:26.235997+05:30","close_reason":"Closed","dependencies":[{"issue_id":"central-xsw","depends_on_id":"central-qzn","type":"parent-child","created_at":"2025-12-29T22:11:55.769733+05:30","created_by":"vivekgupta"}]}

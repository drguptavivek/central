# Minimal ODK Central ModSecurity configuration. CRS rules are expected at:
#   /etc/modsecurity/crs/owasp-crs-setup.conf
#   /etc/modsecurity/crs/owasp-crs-rules/*.conf

# Start from CRS-friendly defaults.
Include /etc/modsecurity/modsecurity.conf-recommended

# Enforce rules.
SecRuleEngine On

# Request body inspection.
SecRequestBodyAccess On
SecResponseBodyAccess Off

# Avoid false-positive internal errors on long query strings (OData filters, etc.).
SecPcreMatchLimit 2000000
SecPcreMatchLimitRecursion 2000000

# Audit logging (file-based, for portability across Docker hosts).
SecAuditEngine RelevantOnly
SecAuditLogType Serial
SecAuditLog /var/log/modsecurity/audit.log
SecAuditLogFormat JSON

# VG/local customization hook (bind-mount `./crs_custom:/etc/modsecurity/custom:ro`).
# Load this *before* CRS so exclusions (ctl/ruleRemoveById) can take effect.
Include /etc/modsecurity/custom/*.conf

# CRS setup + rules.
#
# Canonical paths expected here:
#   /etc/modsecurity/crs/crs-setup.conf
#   /etc/modsecurity/crs/rules/*.conf
Include /etc/modsecurity/crs/crs-setup.conf
Include /etc/modsecurity/crs/rules/*.conf
